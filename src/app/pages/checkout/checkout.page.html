<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button fill="clear" (click)="goToHome()" aria-label="Volver">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Pago</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding" *ngIf="loaded; else loadingTpl">
  <h2>{{ event?.name }}</h2>
  <ion-card>
    <ion-card-header>
      <ion-card-title>Resumen de la compra</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>Zona:</strong> {{ zone?.name }}</p>
      <p><strong>Precio unitario:</strong> {{ zone?.price | currency:'COP':'symbol':'1.0-0' }}</p>
      <p><strong>Disponibles:</strong> {{ zone?.availableTickets }}</p>

      <ion-item>
        <ion-label position="stacked">Cantidad</ion-label>
        <ion-input type="number" min="1" [max]="zone?.availableTickets || 1" [(ngModel)]="quantity"></ion-input>
      </ion-item>

      <p class="total"><strong>Total:</strong> {{ (zone?.price || 0) * quantity | currency:'COP':'symbol':'1.0-0' }}</p>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Método de Pago (Simulado)</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-radio-group [(ngModel)]="paymentMethod">
        <ion-item>
          <ion-radio slot="start" value="card"></ion-radio>
          <ion-label>Tarjeta de crédito (simulado)</ion-label>
        </ion-item>
        <ion-item>
          <ion-radio slot="start" value="paypal" disabled></ion-radio>
          <ion-label>PayPal (guía en comentarios)</ion-label>
        </ion-item>
        <ion-item>
          <ion-radio slot="start" value="googlepay" disabled></ion-radio>
          <ion-label>Google Pay (guía en comentarios)</ion-label>
        </ion-item>
      </ion-radio-group>

      <!-- Campos simulados -->
      <div *ngIf="paymentMethod === 'card'" class="card-form">
        <ion-item>
          <ion-label position="stacked">Número de tarjeta</ion-label>
          <ion-input placeholder="4111 1111 1111 1111"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">Expiración</ion-label>
          <ion-input placeholder="MM/AA"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label position="stacked">CVV</ion-label>
          <ion-input type="password" placeholder="123"></ion-input>
        </ion-item>
      </div>
      <ion-text color="medium" *ngIf="paymentMethod !== 'card'">
        <p>Los métodos reales (PayPal / Google Pay) se integran según guía en código.</p>
      </ion-text>
    </ion-card-content>
  </ion-card>

  <ion-button expand="block" color="success" (click)="simulatePay()" [disabled]="processing || !zone || quantity < 1 || quantity > (zone.availableTickets || 0)">
    <ion-spinner *ngIf="processing" name="lines-small"></ion-spinner>
    <span *ngIf="!processing">Pagar ahora (Simulado)</span>
  </ion-button>

  <ion-text color="danger" *ngIf="errorMsg">{{ errorMsg }}</ion-text>
  <ion-text color="success" *ngIf="successMsg">{{ successMsg }}</ion-text>

  <!-- Guías de integración -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>Guía de Integración Real</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <h3>PayPal</h3>
      <p>1. Instalar SDK: añadir script <code>https://www.paypal.com/sdk/js?client-id=TU_CLIENT_ID</code> en <code>index.html</code>.</p>
      <p>2. Reemplazar el botón simulado por <code>&lt;div id="paypal-button-container"&gt;&lt;/div&gt;</code>.</p>
      <p>3. En <code>ngAfterViewInit</code>, inicializar <code>paypal.Buttons(/* config */)</code> y en <code>onApprove</code> llamar <code>purchaseService.finalizePayPal(orderId)</code>.</p>
      <h3>Google Pay</h3>
      <p>1. Usar Payment Request API o Google Pay JS Library.</p>
      <p>2. Construir <code>paymentDataRequest</code> con precio final y moneda COP.</p>
      <p>3. Al recibir <code>paymentData</code> marcar orden como pagada y crear tickets igual que aquí.</p>
      <h3>Seguridad</h3>
      <p>Los cobros reales deben hacerse en backend para no exponer claves. El frontend obtiene un token y backend confirma el pago y crea los tickets.</p>
    </ion-card-content>
  </ion-card>
</ion-content>

<ng-template #loadingTpl>
  <ion-content class="ion-padding">
    <ion-spinner></ion-spinner>
  </ion-content>
</ng-template>
